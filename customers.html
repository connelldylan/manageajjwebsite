<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customers List</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <h2>Analytics</h2>
            <ul>
                <li><a href="index.html">Overview</a></li>
                <li><a href="customers.html">Members</a></li>
                <li><a href="index.html#metrics">Key Metrics</a></li>
                <li><a href="reports.html">Reports</a></li>
                <li><a href="index.html#settings">Settings</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <div class="header">
                <h1>Member List</h1>
                <p>All registered members</p>
            </div>

            <div class="table-container">
                <table id="customers-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Belt Level</th>
                            <th>Subscription</th> <!-- New column -->
                        </tr>
                    </thead>
                    <tbody id="customers-tbody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Firebase SDK (Compatibility Mode) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCbZ7xXq3ymeWRgXDjOsu-xMvEKwv33ig8",
            authDomain: "member-management-system-cb2dc.firebaseapp.com",
            projectId: "member-management-system-cb2dc",
            storageBucket: "member-management-system-cb2dc.firebasestorage.app",
            messagingSenderId: "834961798562",
            appId: "1:834961798562:web:525a5bbfc7f53000d4eefb",
            measurementId: "G-YE8ZCN42B2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        console.log("Firebase initialized:", db);

        // Function to format phone number as (###) ###-####
        function formatPhoneNumber(phone) {
            if (!phone) return 'N/A';
            const digits = phone.replace(/\D/g, '');
            if (digits.length === 10) {
                return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
            }
            return phone || 'N/A';
        }

        // Function to load members
        function loadMembers() {
            const tbody = document.getElementById('customers-tbody');
            tbody.innerHTML = '';
            console.log("Loading members...");

            db.collection('Members').get()
                .then((querySnapshot) => {
                    console.log("Number of documents retrieved:", querySnapshot.size);
                    if (querySnapshot.empty) {
                        tbody.innerHTML = '<tr><td colspan="5">No members found</td></tr>'; // Updated colspan to 5
                        console.log("No documents in 'Members' collection");
                        return;
                    }
                    querySnapshot.forEach((doc) => {
                        const member = doc.data();
                        console.log("Member data:", member);
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td>${member.Name || 'N/A'}</td>
                            <td>${member.Email || 'N/A'}</td>
                            <td>${formatPhoneNumber(member.PhoneNumber)}</td>
                            <td>${member.BeltLevel || 'N/A'}</td>
                            <td>${member.Subscription || 'N/A'}</td> <!-- New field -->
                        `;
                        
                        tbody.appendChild(row);
                    });
                })
                .catch((error) => {
                    console.error("Error getting members: ", error);
                    tbody.innerHTML = '<tr><td colspan="5">Error loading members: ' + error.message + '</td></tr>'; // Updated colspan to 5
                });
        }

        // Load members when page loads
        window.onload = loadMembers;
    </script>
</body>
</html>